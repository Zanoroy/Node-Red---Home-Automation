<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Solar Widget Demo</title>
    <link rel="stylesheet" href="solar-state-widget.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(90deg, #302b6b 0%, #2e5a90 100%);
            font-family: Arial, sans-serif;
        }
        
        h1 {
            color: #fff;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #adb1c5;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .widget-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
        }
        
        .widget-card h3 {
            color: #fff;
            margin: 0 0 10px 0;
            font-size: 16px;
        }
        
        .widget-container {
            height: 450px;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .controls-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .controls-panel h2 {
            color: #fff;
            margin-top: 0;
            font-size: 20px;
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .control-item label {
            display: block;
            color: #adb1c5;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .control-item input {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: none;
            box-sizing: border-box;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        button {
            background: #336ce6;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #2558c7;
        }
        
        button.secondary {
            background: #5e5f9a;
        }
        
        button.secondary:hover {
            background: #4a4b7a;
        }
        
        .status-display {
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.6;
        }
        
        @media (max-width: 1024px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>üåû Complete Solar Energy Flow Widget</h1>
    <p class="subtitle">Real-time visualization with all components: Solar, Battery, System, Load, and Grid</p>
    
    <div class="demo-grid">
        <!-- Main Large Widget -->
        <div class="widget-card full-width">
            <h3>Full Energy Flow Diagram</h3>
            <div id="mainWidget" class="solar-widget-container widget-container"></div>
        </div>
        
        <!-- Side by Side Comparison -->
        <div class="widget-card">
            <h3>Daytime (Peak Generation)</h3>
            <div id="daytimeWidget" class="solar-widget-container" style="height: 350px;"></div>
        </div>
        
        <div class="widget-card">
            <h3>Nighttime (Grid + Battery)</h3>
            <div id="nightWidget" class="solar-widget-container" style="height: 350px;"></div>
        </div>
    </div>
    
    <div class="controls-panel">
        <h2>Live Controls</h2>
        
        <div class="control-grid">
            <div class="control-item">
                <label for="pvPowerInput">‚òÄÔ∏è PV Power (kW)</label>
                <input type="number" id="pvPowerInput" value="3.5" step="0.1" min="0" max="10">
            </div>
            
            <div class="control-item">
                <label for="batteryPowerInput">üîã Battery Power (kW) [- = charging]</label>
                <input type="number" id="batteryPowerInput" value="1.2" step="0.1" min="-5" max="5">
            </div>
            
            <div class="control-item">
                <label for="batterySocInput">üîã Battery SoC (%)</label>
                <input type="number" id="batterySocInput" value="75" step="1" min="0" max="100">
            </div>
            
            <div class="control-item">
                <label for="loadPowerInput">üè† Load Power (kW)</label>
                <input type="number" id="loadPowerInput" value="4.5" step="0.1" min="0" max="15">
            </div>
        </div>
        
        <div class="button-group">
            <button onclick="updateAllWidgets()">üìä Update All Widgets</button>
            <button onclick="simulateDay()" class="secondary">üåÖ Simulate 24h Cycle</button>
            <button onclick="stopSimulation()" class="secondary">‚èπÔ∏è Stop Simulation</button>
            <button onclick="setScenario('peak')" class="secondary">‚òÄÔ∏è Peak Solar</button>
            <button onclick="setScenario('night')" class="secondary">üåô Night Mode</button>
            <button onclick="setScenario('export')" class="secondary">‚ö° Exporting</button>
        </div>
        
        <div class="status-display" id="statusDisplay">Ready. Use controls above to test the widget.</div>
    </div>
    
    <script>
        // Create widget HTML for each instance
        function createWidgetHTML() {
            return `
                <div class="priority-mode">
                    <span class="value">Load First</span>
                </div>
                <div class="icon-wrapper solar-position">
                    <div class="icon state_solor"></div>
                </div>
                <div class="status-text">
                    <span class="label">System Status:</span>
                    <span class="value">On-Grid mode</span>
                </div>
                <div class="power-display pv-power">
                    <span class="label">PV Power:</span>
                    <span class="value">0.00kW</span>
                </div>
                <div class="icon-wrapper system-position">
                    <div class="icon state_system"></div>
                </div>
                <div class="icon-wrapper battery-position">
                    <div class="icon state_bat_null"></div>
                </div>
                <div class="battery-info">
                    <div class="battery-power">
                        <span class="label">Discharging:</span>
                        <span class="value">0.00kW</span>
                    </div>
                    <div class="battery-soc">
                        <span class="label">SoC:</span>
                        <span class="value">0%</span>
                    </div>
                </div>
                <div class="icon-wrapper load-position">
                    <div class="icon state_load"></div>
                </div>
                <div class="load-info">
                    <span class="label">Consumption:</span>
                    <span class="value">0.00kW</span>
                </div>
                <div class="icon-wrapper grid-position">
                    <div class="icon state_grid"></div>
                </div>
                <div class="grid-info">
                    <span class="label">Import:</span>
                    <span class="value">0.00kW</span>
                </div>
                <div class="flow-line vertical solar-to-system">
                    <i class="flow-dot dot1"></i>
                    <i class="flow-dot dot2"></i>
                    <i class="flow-dot dot3"></i>
                </div>
                <div class="flow-line horizontal battery-to-system">
                    <i class="flow-dot dot1"></i>
                    <i class="flow-dot dot2"></i>
                    <i class="flow-dot dot3"></i>
                </div>
                <div class="flow-line vertical system-to-grid">
                    <i class="flow-dot dot1"></i>
                    <i class="flow-dot dot2"></i>
                    <i class="flow-dot dot3"></i>
                </div>
                <div class="flow-line horizontal system-to-load">
                    <i class="flow-dot dot1"></i>
                    <i class="flow-dot dot2"></i>
                    <i class="flow-dot dot3"></i>
                </div>
            `;
        }
        
        // Initialize all widgets
        document.getElementById('mainWidget').innerHTML = createWidgetHTML();
        document.getElementById('daytimeWidget').innerHTML = createWidgetHTML();
        document.getElementById('nightWidget').innerHTML = createWidgetHTML();
    </script>
    
    <script src="solar-state-widget.js"></script>
    <script>
        let mainWidget, daytimeWidget, nightWidget;
        let simulationInterval = null;
        
        // Initialize after script loads
        setTimeout(() => {
            mainWidget = new SolarStateWidget('mainWidget');
            daytimeWidget = new SolarStateWidget('daytimeWidget');
            nightWidget = new SolarStateWidget('nightWidget');
            
            // Set initial scenarios
            setScenario('peak', daytimeWidget);
            setScenario('night', nightWidget);
            updateAllWidgets();
        }, 100);
        
        function updateAllWidgets() {
            const pvPower = parseFloat(document.getElementById('pvPowerInput').value);
            const batteryPower = parseFloat(document.getElementById('batteryPowerInput').value);
            const batterySoc = parseInt(document.getElementById('batterySocInput').value);
            const loadPower = parseFloat(document.getElementById('loadPowerInput').value);
            const gridPower = loadPower - pvPower - batteryPower;
            
            const data = {
                systemStatus: 'On-Grid mode',
                pvPower: pvPower,
                priorityMode: 'Load First',
                batteryPower: batteryPower,
                batterySoc: batterySoc,
                loadPower: loadPower,
                gridPower: gridPower
            };
            
            if (mainWidget) mainWidget.updateData(data);
            
            document.getElementById('statusDisplay').textContent = 
                `Updated:\n` +
                `PV: ${pvPower.toFixed(2)}kW\n` +
                `Battery: ${batteryPower >= 0 ? 'Discharging' : 'Charging'} ${Math.abs(batteryPower).toFixed(2)}kW (${batterySoc}%)\n` +
                `Load: ${loadPower.toFixed(2)}kW\n` +
                `Grid: ${gridPower >= 0 ? 'Importing' : 'Exporting'} ${Math.abs(gridPower).toFixed(2)}kW`;
        }
        
        function setScenario(scenario, widget = mainWidget) {
            const scenarios = {
                'peak': {
                    pvPower: 5.2,
                    batteryPower: -2.5,  // Charging
                    batterySoc: 95,
                    loadPower: 2.0,
                    gridPower: -0.7  // Exporting
                },
                'night': {
                    pvPower: 0,
                    batteryPower: 3.5,  // Discharging
                    batterySoc: 45,
                    loadPower: 2.8,
                    gridPower: -0.7  // Importing difference
                },
                'export': {
                    pvPower: 6.5,
                    batteryPower: -1.0,
                    batterySoc: 100,
                    loadPower: 2.5,
                    gridPower: -3.0  // Exporting
                }
            };
            
            const data = scenarios[scenario];
            if (data && widget) {
                widget.updateData({...data, systemStatus: 'On-Grid mode', priorityMode: 'Load First'});
                
                // Update inputs if main widget
                if (widget === mainWidget) {
                    document.getElementById('pvPowerInput').value = data.pvPower;
                    document.getElementById('batteryPowerInput').value = data.batteryPower;
                    document.getElementById('batterySocInput').value = data.batterySoc;
                    document.getElementById('loadPowerInput').value = data.loadPower;
                }
                
                document.getElementById('statusDisplay').textContent = `Scenario: ${scenario.toUpperCase()}`;
            }
        }
        
        function simulateDay() {
            if (simulationInterval) return;
            
            let hour = 0;
            document.getElementById('statusDisplay').textContent = 'Simulating 24-hour cycle...';
            
            simulationInterval = setInterval(() => {
                const distanceFromNoon = Math.abs(12 - hour);
                let pvPower = 0;
                
                if (hour >= 6 && hour <= 18) {
                    pvPower = Math.max(0, 5.5 - (distanceFromNoon * 0.45));
                }
                
                let batteryPower = 0;
                let batterySoc = 50;
                
                if (pvPower > 3.5) {
                    batteryPower = -Math.min(2.5, pvPower - 2.5);
                    batterySoc = 50 + ((pvPower / 5.5) * 40);
                } else if (pvPower < 0.5) {
                    batteryPower = Math.min(3.5, 3.5 - pvPower);
                    batterySoc = Math.max(20, 90 - ((24 - hour) * 2));
                }
                
                const baseLoad = 1.5;
                const variableLoad = (hour >= 17 && hour <= 22) ? 2.5 : 1.0;
                const loadPower = baseLoad + variableLoad + (Math.random() * 0.5);
                
                const gridPower = loadPower - pvPower - batteryPower;
                
                if (mainWidget) {
                    mainWidget.updateData({
                        systemStatus: pvPower > 0 ? 'On-Grid mode' : 'Standby',
                        pvPower: pvPower,
                        priorityMode: 'Load First',
                        batteryPower: batteryPower,
                        batterySoc: Math.max(10, Math.min(100, batterySoc)),
                        loadPower: loadPower,
                        gridPower: gridPower
                    });
                }
                
                const timeStr = `${hour.toString().padStart(2, '0')}:00`;
                document.getElementById('statusDisplay').textContent = 
                    `üïê ${timeStr}\n` +
                    `‚òÄÔ∏è Solar: ${pvPower.toFixed(2)}kW\n` +
                    `üîã Battery: ${batteryPower >= 0 ? 'Discharge' : 'Charge'} ${Math.abs(batteryPower).toFixed(2)}kW (${Math.round(batterySoc)}%)\n` +
                    `üè† Load: ${loadPower.toFixed(2)}kW\n` +
                    `‚ö° Grid: ${gridPower >= 0 ? 'Import' : 'Export'} ${Math.abs(gridPower).toFixed(2)}kW`;
                
                hour = (hour + 1) % 24;
            }, 1500);
        }
        
        function stopSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
                document.getElementById('statusDisplay').textContent = 'Simulation stopped.';
            }
        }
    </script>
</body>
</html>
